---
- name: setup mysql service
  hosts: webservers
  sudo: yes
  vars:
    mysql_root_password: whatever
  tasks:
    - name: MySQL | Ensure basic packages are installed
      apt: name={{item}} update-cache=yes
      with_items:
        - curl
        - tree
        - python-mysqldb
    - name: MySQL | Ensure mysql is installed
      apt: pkg=mysql-server state=present
    - name: MySQL | Ensure mysql service is started
      service: name=mysql state=started enabled=yes
    - name: MySQL | update mysql root password for all root accounts
      mysql_user: name=root host={{item}} password={{mysql_root_password}} priv=*.*:ALL,GRANT
      with_items:
        - 127.0.0.1
        - ::1
        - localhost
    - name: MySQL | copy .my.cnf file with root password credentials
      template: src=files/my.cnf dest=/root/.my.cnf owner=root mode=0600

